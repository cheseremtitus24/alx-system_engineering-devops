#!/usr/bin/env bash
# This Script Performs an apt update
# Installs nginx web server
# adds some content to the landing page
# Adds a permanent redirect to a youtube url
# Finally Starts the nginx service

apt-get -y update
apt-get install -y nginx
echo "Hello World!                 " > /var/www/html/index.html

data="location /redirect_me {return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;} "
sed -i "/^\s*server_name _*/a $data" /etc/nginx/sites-enabled/default

echo -e "Ceci n'est pas une page \n" > /var/www/html/404.html
snippet_data="error_page 404 /404.html;"
sed -i "/^location /redirect_me*/a $snippet_data" /etc/nginx/sites-enabled/default
data2="location = /404.html { root /var/www/html; internal; } "
sed -i "/^location /redirect_me*/a $snippet_data" /etc/nginx/sites-enabled/default
sed -i "/^error_page 404 /404.html*/a $data2" /etc/nginx/sites-enabled/default

/etc/init.d/nginx restart
